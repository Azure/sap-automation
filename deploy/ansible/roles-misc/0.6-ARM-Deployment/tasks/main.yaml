
- name:                                "SDAF: Set Deployment Type"
  ansible.builtin.set_fact:
    deployment_type:                   "STANDALONE"
  delegate_to:                         localhost

- name:                                "SDAF: Set Deployment Type"
  ansible.builtin.set_fact:
  delegate_to:                         localhost
    deployment_type:                   "HA"
  when:                                db_high_availability

- name:                                "SDAF: Create ARM deployment name"
  delegate_to:                         localhost
  ansible.builtin.set_fact:
    deployment_name:                   "SDAF-{{ platform | upper}}-{{ deployment_type }}"

- name:                                "SDAF: ARM deployment debug"
  delegate_to:                         localhost
  ansible.builtin.debug:
    msg:
      - "Deployment name: {{ deployment_name }}"
      - "resourceGroupName: {{ resourceGroupName }}"
      - "subscriptionId: {{ subscriptionId }}"

- name:                                "SDAF: Create ARM deployment"
  ansible.builtin.command:             "az deployment group create --resource-group {{ resourceGroupName }} --subscription {{ subscriptionId }} --name {{ deployment_name }} --template-file 'templates/empty-deployment.json'"
  register:                            arm_deployment
  delegate_to:                         localhost

- name:                                "SDAF: Create ARM deployment name"
  delegate_to:                         localhost
  ansible.builtin.debug:
    var:                               arm_deployment

