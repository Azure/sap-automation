---

# /*---------------------------------------------------------------------------8
# |                                                                            |
# |      Set Runtime Parameters - e.g Sub ID , Resource group name             |
# |                                                                            |
# +------------------------------------4--------------------------------------*/

# Validate that the SCS cluster is working as expected
- name:                            "0.0 Validations: - Set Python version {{ distribution_id }}"
  ansible.builtin.set_fact:
    python_version: "python2"

- name:                            "0.0 Validations: - Set Python version {{ distribution_id }}"
  ansible.builtin.set_fact:
    python_version: "python3"
  when: (ansible_distribution | lower ~ ansible_distribution_major_version) in ['suse15', 'redhat8', 'sles_sap15']

# Get BOM bom object
- name:                                "5.6 SCSERS: SCS HA Install - Register BoM"
  ansible.builtin.include_role:
    name:                              roles-sap/3.3.1-bom-utility
    tasks_from:                        bom-register
  vars:
    bom_name:                          "{{ bom_base_name }}"
    task_prefix:                       "SCS HA Install: "
    sa_enabled:                        true
    ansible_python_interpreter:        "{{ python_version }}"
  when:                                bom is not defined

- name:                                "5.6 SCS HA Install: Default instance type"
  ansible.builtin.set_fact:
    instance_type:                      "ASCS"
  when:                                bom.InstanceType is not defined

- name:                                "5.6 SCS HA Install: register instance type"
  ansible.builtin.set_fact:
    instance_type:  >-
                                        {%- set _instance_type = 'ASCS' -%}
                                        {%- if bom.InstanceType == 'JAVA' -%}
                                        {%- set _instance_type = 'SCS' -%}
                                        {%- elif bom.InstanceType == 'ABAP' -%}
                                        {%- set _instance_type = 'ASCS' -%}
                                        {%- else -%}
                                        {%- set _instance_type = 'ASCS' -%}
                                        {%- endif -%}
                                        {{- _instance_type -}}
    public:                            true
  when:                                bom.InstanceType is defined

