---

# /*---------------------------------------------------------------------------8
# | Prepare the sql script  for  data guard initial configuration.             |
# |                                                                            |
# |                                                                            |
# | Step 1 create the SQL scripts for DG                                       |
# +------------------------------------4--------------------------------------*/

# Set Primary and Secondary node names.

- name:                     Setting the primary and Secondary DB names
  ansible.builtin.set_fact:
    ora_primary:           "{{ ansible_play_hosts_all[0] }}"         # Oracle Primary Host
    ora_secondary:         "{{ ansible_play_hosts_all[1] }}"         # Oracle Secondary Host
    current_host:          "{{ ansible_hostname }}"
  when:                     
    - node_tier == "oracle"
    - action == 1



- include_tasks: "ora-dg-secondary-prep.yaml"
  when:   
    - node_tier == "oracle"
    - action == 0

- name:            "Prepare and Restore"
  block:
    - include_tasks: "ora-dg-prep.yaml"
      
    - include_tasks: "ora-dg-setup-primary.yaml"
      when:   
        - current_host == ora_primary
    
    - include_tasks: "ora-dg-setup-secondary.yaml"
      when:   
        - current_host == ora_secondary
  when: 
    - action == 1
    - node_tier == "oracle"
    - node_tier != "observer"

- include_tasks: "ora-dg-postprocessing.yaml"
  when:   
    - node_tier == "oracle"
    - node_tier != "observer"
    - action       == 2


# FSFO is enabled from the Observer.
- include_tasks: "ora-dg-observer-setup.yaml"
  when:   
    - node_tier == "observer"
    - action    == 3


 

...
# /*---------------------------------------------------------------------------8
# |                                   END                                      |
# +------------------------------------4--------------------------------------*/
