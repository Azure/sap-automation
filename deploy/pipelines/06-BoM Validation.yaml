
name: BOM Download

parameters:

- name: bom_base_name
  displayName: BOM Base Name
  type: string
  default: S41909SPS03_v0006ms
  values:
   - S41909SPS03_v0006ms
   - BW4HANA2021SPS01_v0001ms
   - HANA_2_00_055_v0005ms
   - NW750SPS20_v0002ms


- name: deployer_kvname
  displayName: Deployer KeyVault
  type: string
  default: PERMWEEUDEP00user56F 

variables:
- group: 'BOM Validation'
  
- name: bom
  value: ${{ parameters.bom_base_name }}

- name: kv
  value: ${{ parameters.deployer_kvname }}

trigger:
  branches:
    include:
    - main
    - private-preview
  paths:
    include:
    - deploy/ansible/BOM-catalog/*.yaml


pool:
  name: PERM-WEEU-POOL

steps:

  - checkout: self
    clean: true

  - task: Ansible@0
    displayName: 'Run the BOM downloader for $(BOM)'
    inputs:
      ansibleInterface: 'agentMachine'
      playbookPathOnAgentMachine: $(Pipeline.Workspace)'/s/deploy/ansible/playbook_bom_downloader.yaml'
      inventoriesAgentMachine: 'noInventory'
      args: '-e "bom_base_name=$(bom)" -e "deployer_kv_name=$(kv)" -e "kv_name=$(kv)" -e "s_user=$(S-Username)" -e "s_password=$(S-Password)" -e "sapbits_access_key=$(sapbits-access-key)" -e "sapbits_location_base_path=$(sapbits-location-base-path)" -e "sapbits_sas_token=$(sapbits-sas-token)"'

